# Инструкция по созданию шаблона Word

## Обзор

Система использует **docxtemplater** для генерации документов:
- ✅ Сохраняется вся стилизация оригинального шаблона (шрифты, размеры, цвета, форматирование)
- ✅ Простые переменные заменяются по ключевым словам
- ✅ Таблицы заполняются динамически с сохранением стилей
- ✅ Правильно обрабатывает сложную вложенную структуру Word XML

## 1. Простые переменные

Используйте **одинарные** фигурные скобки для переменных: `{VARIABLE_NAME}`

### Доступные переменные:

**Платежное поручение:**
- `{COMPANY_NAME}` - Бенефициар
- `{COMPANY_IIN}` - ИИН/БИН
- `{COMPANY_IIC}` - ИИК
- `{COMPANY_KBE}` - КБе
- `{BENEFICIARY_BANK}` - Банк бенефициара
- `{COMPANY_BIC}` - БИК
- `{PAYMENT_CODE}` - Код назначения платежа

**Счет:**
- `{INVOICE_NUMBER}` - Номер счета
- `{INVOICE_DATE}` - Дата счета

**Стороны:**
- `{SUPPLIER_NAME}` - Поставщик
- `{SUPPLIER_IIN}` - ИИН/БИН поставщика
- `{CLIENT_NAME}` - Покупатель
- `{CLIENT_IIN}` - ИИН/БИН покупателя
- `{CONTRACT}` - Договор

**Итоги:**
- `{TOTAL_SUM}` - Итого
- `{VAT}` - НДС
- `{TOTAL_SUM_IN_WORDS}` - Сумма прописью
- `{EXECUTOR_NAME}` - Исполнитель

### Пример использования:

\`\`\`
Поставщик: {SUPPLIER_NAME}
ИИН/БИН: {SUPPLIER_IIN}
\`\`\`

При генерации документа эти переменные будут заменены на реальные значения, **сохраняя все форматирование** (шрифт, размер, цвет, жирность и т.д.)

## 2. Динамические таблицы

Для таблиц с переменным количеством строк используйте **циклы docxtemplater**

### Как создать динамическую таблицу:

1. **Создайте таблицу с заголовками:**

| № | Код | Наименование | Кол-во | Ед. изм. | Цена за ед. | Сумма |
|---|-----|--------------|--------|----------|-------------|-------|

2. **Добавьте строку-шаблон** под заголовками

3. **В первой ячейке строки-шаблона** напишите начало цикла:
\`\`\`
{#items}
\`\`\`

4. **В остальных ячейках** используйте переменные цикла:
   - Ячейка 1: `{number}` - номер по порядку
   - Ячейка 2: `{code}` - код товара
   - Ячейка 3: `{name}` - наименование
   - Ячейка 4: `{quantity}` - количество
   - Ячейка 5: `{unit}` - единица измерения
   - Ячейка 6: `{price}` - цена за единицу
   - Ячейка 7: `{total}` - сумма

5. **Добавьте строку после шаблона** с закрывающим тегом `{/items}` в первой ячейке

### Структура таблицы:

\`\`\`
┌─────┬──────┬──────────────┬────────┬──────────┬─────────────┬───────┐
│  №  │ Код  │ Наименование │ Кол-во │ Ед. изм. │ Цена за ед. │ Сумма │
├─────┼──────┼──────────────┼────────┼──────────┼─────────────┼───────┤
│{#items}│{code}│    {name}    │{quantity}│  {unit}  │   {price}   │{total}│
├─────┼──────┼──────────────┼────────┼──────────┼─────────────┼───────┤
│{/items}│      │              │        │          │             │       │
└─────┴──────┴──────────────┴────────┴──────────┴─────────────┴───────┘
\`\`\`

**ВАЖНО:** Можно использовать упрощенный вариант - поместить `{#items}` и `{/items}` в одну строку:

\`\`\`
┌─────┬──────┬──────────────┬────────┬──────────┬─────────────┬───────┐
│  №  │ Код  │ Наименование │ Кол-во │ Ед. изм. │ Цена за ед. │ Сумма │
├─────┼──────┼──────────────┼────────┼──────────┼─────────────┼───────┤
│{#items}{number}{/items}│{code}│{name}│{quantity}│{unit}│{price}│{total}│
└─────┴──────┴──────────────┴────────┴──────────┴─────────────┴───────┘
\`\`\`

### Как это работает:

1. Docxtemplater находит цикл `{#items}...{/items}`
2. Для каждого товара создается копия строки между тегами
3. Переменные `{number}`, `{code}`, `{name}` и т.д. заменяются на значения
4. **Сохраняется вся стилизация** строки-шаблона (шрифты, выравнивание, границы, цвета)

## 3. Стилизация

### ✅ Что сохраняется:

- **Шрифты** - Arial, Times New Roman, Calibri и любые другие
- **Размеры шрифтов** - 10pt, 12pt, 14pt и т.д.
- **Цвета** - текста и фона
- **Форматирование** - жирный, курсив, подчеркивание
- **Выравнивание** - по левому краю, по центру, по правому краю
- **Отступы и интервалы**
- **Границы таблиц** - стили, цвета, толщина
- **Фон ячеек**
- **Все остальные стили Word**

### Рекомендации:

1. **Создайте шаблон в Word** с нужной стилизацией
2. **Примените все форматирование** к тексту и таблицам
3. **Вставьте переменные** `{VARIABLE_NAME}` в нужные места
4. **Добавьте цикл** `{#items}...{/items}` для динамических таблиц
5. **Со��раните как .docx**

## 4. Пример полного шаблона

\`\`\`
                    Образец платежного поручения
                    (Arial, 14pt, жирный, по центру)

┌──────────────────────────┬──────────────────────┬─────────────────────┐
│ Бенефициар:              │        ИИК           │        КБе          │
│ {COMPANY_NAME}           │  {COMPANY_IIC}       │  {COMPANY_KBE}      │
│ БИН: {COMPANY_IIN}       │                      │                     │
├──────────────────────────┼──────────────────────┼─────────────────────┤
│ Банк бенефициара:        │        БИК           │ Код назначения      │
│ {BENEFICIARY_BANK}       │  {COMPANY_BIC}       │ {PAYMENT_CODE}      │
└──────────────────────────┴──────────────────────┴─────────────────────┘

        Счет на оплату № {INVOICE_NUMBER} от {INVOICE_DATE}
                    (Arial, 16pt, жирный)

Поставщик: {SUPPLIER_NAME}
ИИН/БИН: {SUPPLIER_IIN}

Покупатель: {CLIENT_NAME}
ИИН/БИН: {CLIENT_IIN}

Договор: {CONTRACT}

┌─────┬──────┬──────────────┬────────┬──────────┬─────────────┬───────┐
│  №  │ Код  │ Наименование │ Кол-во │ Ед. изм. │ Цена за ед. │ Сумма │
├─────┼──────┼──────────────┼────────┼──────────┼─────────────┼───────┤
│{#items}{number}{/items}│{code}│{name}│{quantity}│{unit}│{price}│{total}│
└─────┴──────┴──────────────┴────────┴──────────┴─────────────┴───────┘

                                                    Итого: {TOTAL_SUM}
                                          В том числе НДС: {VAT}

Всего к оплате: {TOTAL_SUM_IN_WORDS}

Исполнитель _____________________________________ / {EXECUTOR_NAME}

М.П.
\`\`\`

## 5. Совместимость переменных

Система автоматически преобразует данные формы в правильные переменные шаблона:

| Переменная шаблона | Поле формы | Описание |
|-------------------|------------|----------|
| `{COMPANY_NAME}` | `beneficiary` | Бенефициар |
| `{COMPANY_IIN}` | `iin_bin` | ИИН/БИН |
| `{COMPANY_IIC}` | `iik` | ИИК |
| `{SUPPLIER_NAME}` | `supplier` | Поставщик |
| `{CLIENT_NAME}` | `customer_name` | Покупатель |
| `{TOTAL_SUM}` | `calculated_total` | Итого |

В шаблоне используйте **заглавные** имена переменных (например, `{COMPANY_NAME}`).

## 6. Устранение проблем

### Проблема: Переменная не заменяется

**Решение:**
- Проверьте правильность написания: `{VARIABLE_NAME}` (одинарные скобки!)
- Убедитесь, что имя переменной совпадает с доступными переменными
- Проверьте, что в скобках нет лишних пробелов

### Проблема: Таблица не заполняется

**Решение:**
- Убедитесь, что цикл написан правильно: `{#items}...{/items}`
- Проверьте, что все переменные внутри цикла правильные: `{number}`, `{code}`, `{name}`, `{quantity}`, `{unit}`, `{price}`, `{total}`
- Убедитесь, что закрывающий тег `{/items}` присутствует

### Проблема: Стили не сохраняются

**Решение:**
- Убедитесь, что используете формат .docx (не .doc)
- Примените стили к самим переменным в шаблоне
- Проверьте, что шаблон корре��тно загружен в систему

### Проблема: Ошибка при генерации

**Решение:**
- Откройте консоль браузера (F12) и проверьте логи
- Убедитесь, что все открывающие теги `{#items}` имеют закрывающие `{/items}`
- Проверьте, что в переменных нет опечаток

## 7. Преимущества docxtemplater

✅ **Полное сохранение стилизации** - все форматирование остается как в оригинале
✅ **Надежность** - правильно обрабатывает сложную структуру Word XML
✅ **Гибкость** - поддержка циклов, условий и других конструкций
✅ **Простота** - интуитивный синтаксис с фигурными скобками
✅ **Совместимость** - работает с любыми стилями и версиями Word
✅ **Производительность** - быстрая обработка даже больших документов

## 8. Дополнительные возможности

### Условия

Вы можете использовать условия для отображения текста только при определенных условиях:

\`\`\`
{#CONTRACT}
Договор: {CONTRACT}
{/CONTRACT}
\`\`\`

Этот текст будет показан только если переменная `CONTRACT` не пустая.

### Инвертированные условия

\`\`\`
{^CONTRACT}
Без договора
{/CONTRACT}
\`\`\`

Этот текст будет показан только если переменная `CONTRACT` пустая.
